<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generator v10.0 (Auto-Connect)</title>
<style>
    :root {
        --primary: #1a73e8; /* Google Blue */
        --secondary: #e8f0fe;
        --bg-color: #f8f9fa;
        --card-bg: #ffffff;
        --text: #202124;
    }

    body {
        font-family: 'Google Sans', 'Segoe UI', Tahoma, sans-serif;
        background-color: var(--bg-color);
        color: var(--text);
        margin: 0;
        padding: 20px;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: flex-start;
    }

    .container {
        background: var(--card-bg);
        width: 100%;
        max-width: 800px;
        padding: 30px;
        border-radius: 24px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        border: 1px solid #dadce0;
    }

    h1 {
        text-align: center;
        background: linear-gradient(90deg, #4285F4, #9B72CB, #EA4335);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        font-size: 32px;
        margin: 0 0 10px 0;
        font-weight: 800;
    }

    p.subtitle {
        text-align: center;
        color: #5f6368;
        font-size: 14px;
        margin-bottom: 30px;
    }

    /* API KEY BOX */
    .api-box {
        background: #e6f4ea; /* Green tint for success */
        padding: 15px;
        border-radius: 12px;
        border: 1px solid #ceead6;
        margin-bottom: 20px;
        text-align: center;
    }
    .api-status {
        color: #137333;
        font-weight: bold;
        font-size: 13px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }

    /* CONTROLS */
    .control-box {
        background: #fff;
        padding: 20px;
        border-radius: 16px;
        border: 1px solid #dadce0;
        margin-bottom: 15px;
    }

    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
    .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }

    @media (max-width: 600px) {
        .grid-2, .grid-3 { grid-template-columns: 1fr; }
    }

    label {
        display: block;
        font-size: 12px;
        font-weight: 700;
        margin-bottom: 6px;
        color: #5f6368;
        text-transform: uppercase;
    }

    input, select {
        width: 100%;
        padding: 14px;
        border: 1px solid #dadce0;
        border-radius: 8px;
        font-size: 14px;
        box-sizing: border-box;
        transition: 0.2s;
        background: #fff;
    }
    input:focus, select:focus {
        border-color: var(--primary);
        outline: none;
        box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
    }

    /* BUTTON */
    button.generate-btn {
        width: 100%;
        background: linear-gradient(90deg, #4285F4, #34A853);
        color: white;
        border: none;
        padding: 18px;
        font-size: 16px;
        font-weight: 800;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s;
        margin-top: 10px;
        box-shadow: 0 4px 10px rgba(66, 133, 244, 0.3);
    }
    button.generate-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(66, 133, 244, 0.4); }
    button.generate-btn:disabled { background: #ccc; cursor: not-allowed; }

    /* RESULT AREA */
    .result-container {
        margin-top: 30px;
        text-align: center;
        background: #f1f3f4;
        padding: 20px;
        border-radius: 16px;
        min-height: 200px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }

    #generated-image {
        max-width: 100%;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        display: none;
        margin-top: 15px;
    }

    .loader {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #34A853;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        display: none;
        margin-bottom: 15px;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    .status-text { font-size: 13px; color: #5f6368; font-weight: bold; }
    
    .prompt-preview {
        font-family: monospace;
        font-size: 10px;
        color: #888;
        background: #fff;
        padding: 10px;
        border-radius: 8px;
        width: 100%;
        margin-top: 15px;
        text-align: left;
        display: none;
        white-space: pre-wrap;
    }
</style>
</head>
<body>

<div class="container">
    <h1>‚ú® Generator v10.0</h1>
    <p class="subtitle">Sudah Terhubung ke Gemini AI</p>

    <div class="api-box">
        <div class="api-status">
            <span>‚úÖ API Key Terdeteksi & Siap Digunakan</span>
        </div>
        <input type="hidden" id="api-key" value="AIzaSyCQFnM5MX76kCbVEAKkD5qMbHFjDe9EZ0I">
    </div>

    <div class="control-box">
        <div class="grid-2">
            <div>
                <label>Gaya Visual</label>
                <select id="art-style">
                    <option value="paper">‚úÇÔ∏è 3D Paper Craft (Origami)</option>
                    <option value="watercolor">üé® Watercolor (Cat Air)</option>
                </select>
            </div>
            <div>
                <label>Rasio</label>
                <select id="ratio">
                    <option value="1:1">Square (1:1)</option>
                    <option value="3:4">Portrait (3:4)</option>
                    <option value="16:9">Landscape (16:9)</option>
                </select>
            </div>
        </div>
    </div>

    <div class="control-box">
        <label>Detail Karakter (Kartun)</label>
        <div class="grid-3">
            <select id="char-gender">
                <option value="Muslim man">Pria Muslim</option>
                <option value="Muslim woman hijab">Wanita Hijab</option>
                <option value="Little Muslim boy">Anak Laki</option>
                <option value="Little Muslim girl hijab">Anak Perempuan</option>
            </select>
            <input type="text" id="char-top" placeholder="Warna Baju (misal: Putih)">
            <input type="text" id="char-bottom" placeholder="Warna Celana/Rok">
        </div>
        
        <div style="margin-top:15px">
            <label>Aktivitas & Situasi</label>
            <input type="text" id="activity" placeholder="Jelaskan aktivitasnya (Contoh: Sedang membaca Quran di bawah pohon rindang)">
        </div>

        <div class="grid-2" style="margin-top:15px">
            <div><label>Judul (Atas)</label><input type="text" id="head-text"></div>
            <div><label>Sub-Teks (Bawah)</label><input type="text" id="sub-text"></div>
        </div>
        
        <div style="margin-top:15px">
             <label>Footer Sosmed</label>
             <input type="text" id="sosmed" placeholder="@namaakun">
        </div>
    </div>

    <button class="generate-btn" onclick="processWithGemini()">‚ö° GENERATE GAMBAR (OTOMATIS)</button>

    <div class="result-container">
        <div class="loader" id="loader"></div>
        <div class="status-text" id="status-text">Menunggu perintah...</div>
        <img id="generated-image" alt="Result">
        <div class="prompt-preview" id="prompt-debug"></div>
        
        <button id="dl-btn" onclick="downloadImage()" style="display:none; margin-top:15px; background:#333; color:white; border:none; padding:10px 20px; border-radius:8px; cursor:pointer;">‚¨áÔ∏è Download Gambar</button>
    </div>
</div>

<script>
    // --- 1. FUNGSI MEMANGGIL GEMINI API ---
    async function processWithGemini() {
        const apiKey = document.getElementById('api-key').value;
        
        // UI Loading
        setLoading(true, "Menghubungi Gemini untuk meracik prompt...");

        // Ambil Data User
        const style = document.getElementById('art-style').value;
        const gender = document.getElementById('char-gender').value;
        const top = document.getElementById('char-top').value || "Color matching clothes";
        const bot = document.getElementById('char-bottom').value || "Color matching pants";
        const act = document.getElementById('activity').value || "Standing politely";
        const head = document.getElementById('head-text').value;
        const sub = document.getElementById('sub-text').value;
        const sosmed = document.getElementById('sosmed').value;

        // Tentukan Instruksi Style untuk Gemini
        let styleInstruction = "";
        if (style === 'paper') {
            styleInstruction = "Style: High quality 3D Paper Craft illustration, origami style, folded paper texture, low poly art. Depth of field effect with floating paper icons in background.";
        } else {
            styleInstruction = "Style: High quality Hand-drawn Watercolor illustration, soft pastel and earthy tones, textured watercolor paper background, artistic and emotional mood.";
        }

        // Prompt Konstruksi untuk Gemini (System Prompt)
        const systemPrompt = `
        You are an expert AI Prompt Engineer for image generation (Flux/Midjourney).
        Your task is to write a single, detailed, high-quality English prompt based on the user's input.
        
        CONSTRAINTS:
        1. Character: Cute stylized faceless ${gender}, cartoon proportions, simplified anatomy (NOT realistic). Wearing ${top} top and ${bot} bottom.
        2. Action: ${act}.
        3. ${styleInstruction}
        4. Layout: Vertical composition. If text is present, keep the top area empty (negative space).
        5. Text: "Big bold 3D text '${head}' at top, small text '${sub}' below it". (Only include this if user provided text).
        6. Footer: "Small text '${sosmed}' at bottom".
        7. NO conversational filler. JUST the prompt string.
        `;

        try {
            // Fetch ke Gemini API
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: systemPrompt }] }]
                })
            });

            const data = await response.json();
            
            if (data.error) {
                throw new Error("API Key Error: " + data.error.message);
            }

            // Ambil hasil teks dari Gemini
            const geminiPrompt = data.candidates[0].content.parts[0].text;
            
            // Tampilkan debug prompt
            document.getElementById('prompt-debug').style.display = 'block';
            document.getElementById('prompt-debug').innerText = "Gemini Prompt:\n" + geminiPrompt;

            // Lanjut generate gambar
            generateImage(geminiPrompt);

        } catch (error) {
            setLoading(false, "Error: " + error.message);
        }
    }

    // --- 2. FUNGSI GENERATE GAMBAR (POLLINATIONS) ---
    function generateImage(finalPrompt) {
        setLoading(true, "Sedang menggambar...");
        
        const ratio = document.getElementById('ratio').value;
        let width = 1024, height = 1024;
        if(ratio === '3:4') { width = 768; height = 1024; }
        if(ratio === '16:9') { width = 1024; height = 576; }

        const seed = Math.floor(Math.random() * 999999);
        const encodedPrompt = encodeURIComponent(finalPrompt);
        
        // URL Image Generator
        const imageUrl = `https://image.pollinations.ai/prompt/${encodedPrompt}?width=${width}&height=${height}&seed=${seed}&model=flux&nologo=true`;

        const imgEl = document.getElementById('generated-image');
        
        imgEl.onload = () => {
            setLoading(false, "Selesai!");
            imgEl.style.display = 'block';
            document.getElementById('dl-btn').style.display = 'inline-block';
        };
        
        imgEl.onerror = () => {
            setLoading(false, "Gagal memuat gambar.");
        };

        imgEl.src = imageUrl;
    }

    // --- UTILITIES ---
    function setLoading(isLoading, text) {
        const loader = document.getElementById('loader');
        const status = document.getElementById('status-text');
        
        if (isLoading) {
            loader.style.display = 'block';
            document.getElementById('generated-image').style.display = 'none';
            document.getElementById('dl-btn').style.display = 'none';
        } else {
            loader.style.display = 'none';
        }
        status.innerText = text;
    }

    function downloadImage() {
        const img = document.getElementById('generated-image');
        const link = document.createElement('a');
        link.href = img.src;
        link.download = 'hasil-gambar.png';
        link.target = '_blank';
        link.click();
    }
</script>

</body>
</html>
